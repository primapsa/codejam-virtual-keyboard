const config = [
  [
    {
      key: 'Backquote',
      'en upper': '~',
      'en lower': '`',
      'ru upper': 'Ё',
      'ru lower': 'ё',
    },
    {
      key: 'Digit1',
      'en lower': '1',
      'en upper': '!',
      'ru lower': '1',
      'ru upper': '!',

    },
    {
      key: 'Digit2',
      'en lower': '2',
      'en upper': '@',
      'ru lower': '2',
      'ru upper': '"',
    },
    {
      key: 'Digit3',
      'en lower': '3',
      'en upper': '#',
      'ru lower': '3',
      'ru upper': '№',
    },
    {
      key: 'Digit4',
      'en lower': '4',
      'en upper': '$',
      'ru lower': '4',
      'ru upper': ';',
    },
    {
      key: 'Digit5',
      'en lower': '5',
      'en upper': '%',
      'ru lower': '5',
      'ru upper': '%',
    },
    {
      key: 'Digit6',
      'en lower': '6',
      'en upper': '^',
      'ru lower': '6',
      'ru upper': ':',
    },
    {
      key: 'Digit7',
      'en lower': '7',
      'en upper': '&',
      'ru lower': '7',
      'ru upper': '?',
    },
    {
      key: 'Digit8',
      'en lower': '8',
      'en upper': '*',
      'ru lower': '8',
      'ru upper': '*',
    },
    {
      key: 'Digit9',
      'en lower': '9',
      'en upper': '(',
      'ru lower': '9',
      'ru upper': '(',
    },
    {
      key: 'Digit0',
      'en lower': '0',
      'en upper': ')',
      'ru lower': '0',
      'ru upper': ')',
    },
    {
      key: 'Minus',
      'en lower': '-',
      'en upper': '_',
      'ru lower': '-',
      'ru upper': '_',
    },
    {
      key: 'Equal',
      'en lower': '=',
      'en upper': '+',
      'ru lower': '=',
      'ru upper': '+',
    },
    {
      key: 'Backspace',
      'en lower': 'Backspace',
      'en upper': 'Backspace',
      'ru lower': 'Backspace',
      'ru upper': 'Backspace',
    },

  ],
  [
    {
      key: 'Tab',
      'en lower': 'Tab',
      'en upper': 'Tab',
      'ru lower': 'Tab',
      'ru upper': 'Tab',
    },
    {
      key: 'KeyQ',
      'en lower': 'q',
      'en upper': 'Q',
      'ru lower': 'й',
      'ru upper': 'Й',
    },
    {
      key: 'KeyW',
      'en lower': 'w',
      'en upper': 'W',
      'ru lower': 'ц',
      'ru upper': 'Ц',
    },
    {
      key: 'KeyE',
      'en lower': 'e',
      'en upper': 'E',
      'ru lower': 'у',
      'ru upper': 'У',
    },
    {
      key: 'KeyR',
      'en lower': 'r',
      'en upper': 'R',
      'ru lower': 'к',
      'ru upper': 'К',
    },
    {
      key: 'KeyT',
      'en lower': 't',
      'en upper': 'T',
      'ru lower': 'е',
      'ru upper': 'Е',
    },
    {
      key: 'KeyY',
      'en lower': 'y',
      'en upper': 'Y',
      'ru lower': 'н',
      'ru upper': 'Н',
    },
    {
      key: 'KeyU',
      'en lower': 'u',
      'en upper': 'U',
      'ru lower': 'г',
      'ru upper': 'Г',
    },
    {
      key: 'KeyI',
      'en lower': 'i',
      'en upper': 'I',
      'ru lower': 'ш',
      'ru upper': 'Ш',
    },
    {
      key: 'KeyO',
      'en lower': 'o',
      'en upper': 'O',
      'ru lower': 'щ',
      'ru upper': 'Щ',
    },
    {
      key: 'KeyP',
      'en lower': 'p',
      'en upper': 'P',
      'ru lower': 'з',
      'ru upper': 'З',
    },
    {
      key: 'BracketLeft',
      'en lower': '[',
      'en upper': '{',
      'ru lower': 'х',
      'ru upper': 'Х',
    },
    {
      key: 'BracketRight',
      'en lower': ']',
      'en upper': '}',
      'ru lower': 'ъ',
      'ru upper': 'Ъ',
    },
    {
      key: 'Backslash',
      'en lower': '\\',
      'en upper': '/',
      'ru lower': '\\',
      'ru upper': '/',
    },
    {
      key: 'Delete',
      'en lower': 'Del',
      'en upper': 'Del',
      'ru lower': 'Del',
      'ru upper': 'Del',
    },
  ],
  [
    {
      key: 'CapsLock',
      'en lower': 'CapsLock',
      'en upper': 'CapsLock',
      'ru lower': 'CapsLock',
      'ru upper': 'CapsLock',
    },
    {
      key: 'KeyA',
      'en lower': 'a',
      'en upper': 'A',
      'ru lower': 'ф',
      'ru upper': 'Ф',
    },
    {
      key: 'KeyS',
      'en lower': 's',
      'en upper': 'S',
      'ru lower': 'ы',
      'ru upper': 'Ы',
    },
    {
      key: 'KeyD',
      'en lower': 'd',
      'en upper': 'D',
      'ru lower': 'в',
      'ru upper': 'В',
    },
    {
      key: 'KeyF',
      'en lower': 'f',
      'en upper': 'F',
      'ru lower': 'а',
      'ru upper': 'А',
    },
    {
      key: 'KeyG',
      'en lower': 'g',
      'en upper': 'G',
      'ru lower': 'п',
      'ru upper': 'П',
    },
    {
      key: 'KeyH',
      'en lower': 'h',
      'en upper': 'H',
      'ru lower': 'р',
      'ru upper': 'Р',
    },
    {
      key: 'KeyJ',
      'en lower': 'j',
      'en upper': 'J',
      'ru lower': 'о',
      'ru upper': 'О',
    },
    {
      key: 'KeyK',
      'en lower': 'k',
      'en upper': 'K',
      'ru lower': 'л',
      'ru upper': 'Л',
    },
    {
      key: 'KeyL',
      'en lower': 'l',
      'en upper': 'L',
      'ru lower': 'д',
      'ru upper': 'Д',
    },
    {
      key: 'Semicolon',
      'en lower': ';',
      'en upper': ':',
      'ru lower': 'ж',
      'ru upper': 'Ж',
    },
    {
      key: 'Quote',
      'en lower': '\'',
      'en upper': '"',
      'ru lower': 'э',
      'ru upper': 'Э',
    },
    {
      key: 'Enter',
      'en lower': 'Enter',
      'en upper': 'Enter',
      'ru lower': 'Enter',
      'ru upper': 'Enter',
    },
  ],
  [
    {
      key: 'ShiftLeft',
      'en lower': 'Shift',
      'en upper': 'Shift',
      'ru lower': 'Shift',
      'ru upper': 'Shift',
    },
    {
      key: 'KeyZ',
      'en lower': 'z',
      'en upper': 'Z',
      'ru lower': 'я',
      'ru upper': 'Я',
    },
    {
      key: 'KeyX',
      'en lower': 'x',
      'en upper': 'X',
      'ru lower': 'ч',
      'ru upper': 'Ч',
    },
    {
      key: 'KeyC',
      'en lower': 'c',
      'en upper': 'C',
      'ru lower': 'с',
      'ru upper': 'С',
    },
    {
      key: 'KeyV',
      'en lower': 'v',
      'en upper': 'V',
      'ru lower': 'м',
      'ru upper': 'М',
    },
    {
      key: 'KeyB',
      'en lower': 'b',
      'en upper': 'B',
      'ru lower': 'и',
      'ru upper': 'И',
    },
    {
      key: 'KeyN',
      'en lower': 'n',
      'en upper': 'N',
      'ru lower': 'т',
      'ru upper': 'Т',
    },
    {
      key: 'KeyM',
      'en lower': 'm',
      'en upper': 'M',
      'ru lower': 'ь',
      'ru upper': 'Ь',
    },
    {
      key: 'Comma',
      'en lower': ',',
      'en upper': '<',
      'ru lower': 'б',
      'ru upper': 'Б',
    },
    {
      key: 'Period',
      'en lower': '.',
      'en upper': '>',
      'ru lower': 'ю',
      'ru upper': 'Ю',
    },
    {
      key: 'Slash',
      'en lower': '/',
      'en upper': '?',
      'ru lower': '.',
      'ru upper': ',',
    },
    {
      key: 'ArrowUp',
      'en lower': '&#9650;',
      'en upper': '&#9650;',
      'ru lower': '&#9650;',
      'ru upper': '&#9650;',
    },
    {
      key: 'ShiftRight',
      'en lower': 'Shift',
      'en upper': 'Shift',
      'ru lower': 'Shift',
      'ru upper': 'Shift',
    },
  ],
  [
    {
      key: 'ControlLeft',
      'en lower': 'ctrl',
      'en upper': 'ctrl',
      'ru lower': 'ctrl',
      'ru upper': 'ctrl',
    },

    {
      key: 'MetaLeft',
      'en lower': 'Win',
      'en upper': 'Win',
      'ru lower': 'Win',
      'ru upper': 'Win',
    },
    {
      key: 'AltLeft',
      'en lower': 'alt',
      'en upper': 'alt',
      'ru lower': 'alt',
      'ru upper': 'alt',
    },
    {
      key: 'Space',
      'en lower': ' ',
      'en upper': ' ',
      'ru lower': ' ',
      'ru upper': ' ',
    },
    {
      key: 'AltRight',
      'en lower': 'alt',
      'en upper': 'alt',
      'ru lower': 'alt',
      'ru upper': 'alt',
    },
    {
      key: 'ArrowLeft',
      'en lower': '&#9668;',
      'en upper': '&#9668;',
      'ru lower': '&#9668;',
      'ru upper': '&#9668;',
    },
    {
      key: 'ArrowDown',
      'en lower': '&#9660;',
      'en upper': '&#9660;',
      'ru lower': '&#9660;',
      'ru upper': '&#9660;',
    },
    {
      key: 'ArrowRight',
      'en lower': '&#9658;',
      'en upper': '&#9658;',
      'ru lower': '&#9658;',
      'ru upper': '&#9658;',
    },
    {
      key: 'ControlRight',
      'en lower': 'ctrl',
      'en upper': 'ctrl',
      'ru lower': 'ctrl',
      'ru upper': 'ctrl',
    },


  ],

];
const controls = ['Tab', 'CapsLock', 'ShiftLeft', 'ShiftRight', 'ControlLeft', 'MetaLeft', 'AltLeft', 'Space', 'AltRight', 'ControlRight', 'Backspace', 'Enter', 'Delete'];
if (!localStorage.currenLang) localStorage.currenLang = 'en';
let altPressed = false;
let capsLockEnabled = false;
let shiftPressed = false;
const lang = localStorage.currenLang;
let secondLang;

lang === 'en' ? secondLang = 'ru' : secondLang = 'en';
document.body.insertAdjacentHTML('afterbegin', '<div class="wrapper" id="wrapper"><textarea  class="area" id="result" rows="5" cols="30"></textarea><div class="keyboard" id="keyboard"></div>');
for (let i = 0; i < config.length; i++) {
  const divLine = document.createElement('div');
  divLine.classList.add('line');
  for (let j = 0; j < config[i].length; j++) {
    const divKey = document.createElement('div');
    divKey.classList.add('key');
    divKey.classList.add(`key-${config[i][j].key}`);
    divKey.insertAdjacentHTML('afterbegin', `<div class="${config[i][j].key} show">
        <span class="${lang} lower active">${config[i][j][`${lang} lower`]}</span>
        <span class="${lang} upper disabled">${config[i][j][`${lang} upper`]}</span></div>
        <div class="${config[i][j].key} disabled">
        <span class="${secondLang} lower active">${config[i][j][`${secondLang} lower`]}</span>
        <span class="${secondLang} upper disabled">${config[i][j][`${secondLang} upper`]}</span></div>`);
    divLine.append(divKey);
  }
  keyboard.append(divLine);
}
wrapper.append(keyboard);

function changeLang() {
  const currentLang = keyboard.querySelectorAll('.key');

  for (let i = 0; i < currentLang.length; i++) {
    const firstChildLang = currentLang[i].children[0].classList[1];
    const secondChildLanf = currentLang[i].children[1].classList[1];
    currentLang[i].children[0].classList.remove(firstChildLang);
    currentLang[i].children[0].classList.add(secondChildLanf);
    currentLang[i].children[1].classList.remove(secondChildLanf);
    currentLang[i].children[1].classList.add(firstChildLang);
  }
  let localLang = keyboard.querySelector('.show');
  localLang = localLang.querySelector('span');
  localStorage.currenLang = localLang.classList[0];
}

function keyLightOn(active) {
  active.closest('.key').classList.add('clicked');
}

function keyLightOff(active) {
  active.closest('.key').classList.remove('clicked');
}

function capsLetters(active) {
  if (capsLockEnabled) {
    keyLightOff(active);
    capsLockEnabled = false;
  } else {
    keyLightOn(active);
    capsLockEnabled = true;
  }


  const bigLetter = keyboard.querySelectorAll('.show');
  for (let i = 0; i < bigLetter.length; i++) {
    const firstChildLetter = bigLetter[i].children[0].classList[2];
    const secondChildLetter = bigLetter[i].children[1].classList[2];
    bigLetter[i].children[0].classList.add(secondChildLetter);
    bigLetter[i].children[0].classList.remove(firstChildLetter);
    bigLetter[i].children[1].classList.add(firstChildLetter);
    bigLetter[i].children[1].classList.remove(secondChildLetter);
  }
}

function shiftLetters() {
  if (shiftPressed) {
    shiftPressed = false;
  } else {
    shiftPressed = true;
  }

  const bigLetter = keyboard.querySelectorAll('.show');
  for (let i = 0; i < bigLetter.length; i++) {
    const firstChildLetter = bigLetter[i].children[0].classList[2];
    const secondChildLetter = bigLetter[i].children[1].classList[2];
    bigLetter[i].children[0].classList.add(secondChildLetter);
    bigLetter[i].children[0].classList.remove(firstChildLetter);
    bigLetter[i].children[1].classList.add(firstChildLetter);
    bigLetter[i].children[1].classList.remove(secondChildLetter);
  }
}

function printLetter(active, code) {
  let letterCase = 'lower';
  if (capsLockEnabled || shiftPressed) {
    letterCase = 'upper';
  }

  const printActive = active.querySelector('.active').innerText;
  if (controls.indexOf(code) !== -1) {
    switch (code) {
      case 'Tab':
        result.value += '  ';
        break;
      case ('Backspace'):
        result.value = result.value.substr(0, result.value.length - 1);
        break;
      case ('Enter'):
        result.value += '\n';
        break;
      case ('Space'):
        result.value += ' ';
        break;
    }
  } else {
    result.value += printActive;
  }
}

function pressedUp(event) {
  const eventCode = event.code;
  const active = keyboard.querySelector(`.${eventCode}.show`);

  if (eventCode !== 'CapsLock') {
    keyLightOn(active);
  }

  if (eventCode === 'AltLeft') {
    altPressed = true;
  }
  if ((eventCode === 'ControlLeft') && altPressed) {
    changeLang();
  }
  if (eventCode === 'CapsLock') {
    capsLetters(active);
  }
  if ((eventCode === 'ShiftLeft' || eventCode === 'ShiftRight') && shiftPressed === false) {
    shiftLetters();
  }

  printLetter(active, eventCode);
}

function pressedDown(event) {
  const eventCode = event.code;
  const active = keyboard.querySelector(`.${eventCode}`);

  if (eventCode !== 'CapsLock') {
    keyLightOff(active);
  }
  if (eventCode === 'AltLeft') {
    altPressed = false;
  }
  if (eventCode === 'ShiftLeft' || eventCode === 'ShiftRight') {
    shiftLetters();
  }
}
function mouseClickUp(event) {
  const target = event.target.closest('div');
  keyLightOff(target);
  printLetter(target, target.classList[0]);
}

function mouseClickDown(event) {
  const target = event.target.closest('div');
  keyLightOn(target);
}

document.addEventListener('keydown', pressedUp);
document.addEventListener('keyup', pressedDown);
const keyListener = keyboard.querySelectorAll('.key');
for (let i = 0; i < keyListener.length; i++) {
  keyListener[i].addEventListener('mouseup', mouseClickUp);
  keyListener[i].addEventListener('mousedown', mouseClickDown);
}
